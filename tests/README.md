# اختبارات Building Forge

## نظرة عامة

هذا المجلد يحتوي على جميع اختبارات Building Forge، بما في ذلك اختبارات الوحدة واختبارات الخصائص (Property-Based Tests) باستخدام fast-check.

## هيكل المجلد

```
tests/
├── properties/           # اختبارات الخصائص
│   └── export-properties.test.ts
├── generators/          # مولدات البيانات العشوائية
│   └── export-generators.ts
├── mocks/              # Mock implementations
│   └── export-mocks.ts
├── setup/              # إعداد بيئة الاختبار
│   └── export-test-setup.ts
├── types/              # تعريف الأنواع للاختبارات
│   └── export-types.ts
└── README.md           # هذا الملف
```

## المهمة 12.5: اختبارات خاصية التصدير

### الوصف

تم تنفيذ اختبارات خاصية شاملة لنظام التصدير في Building Forge، والتي تتحقق من المتطلبات 8.1-8.7 من وثيقة المتطلبات.

### الخصائص المختبرة

#### الخاصية 23: تصدير GLB و OBJ صالح

- **المتطلبات**: 8.1, 8.2
- **الوصف**: التحقق من أن التصدير ينتج ملفات GLB و OBJ صالحة ومتوافقة مع محركات الألعاب
- **التكرارات**: 100

#### الخاصية 24: خيارات جودة التصدير

- **المتطلبات**: 8.3
- **الوصف**: التحقق من أن مستويات الجودة المختلفة تنتج نتائج مختلفة ومناسبة
- **التكرارات**: 100

#### الخاصية 25: ضغط النسيج

- **المتطلبات**: 8.4
- **الوصف**: التحقق من ضغط النسيج إلى الدقة المحددة مع الحفاظ على الجودة
- **التكرارات**: 100

#### الخاصية 26: تحسين المضلعات

- **المتطلبات**: 8.5
- **الوصف**: التحقق من تقليل عدد المضلعات مع الحفاظ على الجودة البصرية
- **التكرارات**: 100

#### الخاصية 27: إنتاج شبكات التصادم

- **المتطلبات**: 8.6
- **الوصف**: التحقق من إنتاج شبكات تصادم صحيحة ومحسنة للفيزياء
- **التكرارات**: 100

#### الخاصية 28: تضمين مواد PBR

- **المتطلبات**: 8.7
- **الوصف**: التحقق من تضمين مواد PBR بشكل صحيح مع التوافق مع محركات الألعاب
- **التكرارات**: 100

### اختبار التكامل الشامل

- **الوصف**: اختبار شامل لجميع خصائص التصدير معاً
- **التكرارات**: 50

## المكونات الرئيسية

### 1. مولدات البيانات العشوائية (Generators)

- `generateRandomBuilding()`: إنتاج مباني عشوائية للاختبار
- `generateRandomPBRMaterial()`: إنتاج مواد PBR عشوائية
- `generateRandomExportSettings()`: إنتاج إعدادات تصدير عشوائية
- `createTestBuilding()`: إنشاء مبنى اختبار بسيط
- `createTestMaterial()`: إنشاء مادة اختبار بسيطة

### 2. Mock Implementations

- `MockGameOptimizedGLBExporter`: مصدر GLB وهمي
- `MockOBJExporter`: مصدر OBJ وهمي
- `MockExportOptimizer`: محسن التصدير الوهمي
- `MockPBRMaterialExporter`: مصدر المواد الوهمي
- `MockCollisionMeshGenerator`: مولد شبكات التصادم الوهمي

### 3. إعداد بيئة الاختبار

- إعداد JSDOM للمتصفح الوهمي
- إعداد WebGL context وهمي
- إعداد File API وهمي
- إعداد Canvas API وهمي
- مساعدات الاختبار والتحقق

### 4. تعريف الأنواع

- تعريف جميع الأنواع المطلوبة للاختبارات
- واجهات المصدرين والمحسنين
- أنواع البيانات والإعدادات

## تشغيل الاختبارات

```bash
# تشغيل جميع الاختبارات
npm test

# تشغيل اختبارات التصدير فقط
npm test export-properties

# تشغيل الاختبارات مع تغطية الكود
npm run test:coverage

# تشغيل الاختبارات في وضع المراقبة
npm run test:watch
```

## إعدادات الاختبار

### Vitest Configuration

- **البيئة**: jsdom
- **مهلة الاختبار**: 30 ثانية (للاختبارات المعقدة)
- **عدد الخيوط**: 4 كحد أقصى
- **تغطية الكود**: v8 provider مع حد أدنى 80%

### Fast-Check Configuration

- **الحد الأدنى للتكرارات**: 100 لكل اختبار خاصية
- **الحد الأقصى لحجم الملف**: 10MB
- **الحد الأقصى لعدد المضلعات**: 100,000

## الميزات المتقدمة

### 1. التحقق من صحة GLB

- فحص GLB header الصحيح
- التحقق من بنية الملف
- التحقق من وجود البيانات الثنائية

### 2. التحقق من صحة OBJ

- فحص محتوى OBJ الصحيح
- التحقق من وجود vertices و faces
- التحقق من تنسيق الملف

### 3. قياس الأداء

- قياس وقت التنفيذ
- مراقبة استخدام الذاكرة
- تحليل معدلات الضغط

### 4. معالجة الأخطاء

- اختبار حالات الخطأ المختلفة
- التحقق من رسائل الخطأ الواضحة
- اختبار الاستعادة من الأخطاء

## أفضل الممارسات

### 1. كتابة الاختبارات

- استخدم أسماء وصفية للاختبارات
- اكتب تعليقات واضحة للخصائص
- تأكد من تغطية جميع الحالات الحدية

### 2. مولدات البيانات

- تأكد من إنتاج بيانات واقعية
- اختبر الحالات الحدية والقيم الاستثنائية
- استخدم قيود منطقية للبيانات

### 3. Mock Implementations

- اجعل المحاكيات واقعية قدر الإمكان
- تأكد من محاكاة السلوك الصحيح
- اختبر حالات النجاح والفشل

### 4. الأداء

- راقب أوقات تنفيذ الاختبارات
- استخدم عدد تكرارات مناسب
- تجنب الاختبارات البطيئة غير الضرورية

## المتطلبات المحققة

تحقق هذه الاختبارات المتطلبات التالية من وثيقة المتطلبات:

- **8.1**: تصدير GLB محسن لمحركات الألعاب الحديثة
- **8.2**: تصدير OBJ للتوافق مع الأدوات القديمة
- **8.3**: خيارات مستوى الجودة (عالي، متوسط، منخفض)
- **8.4**: ضغط النسيج حسب الدقة المحددة
- **8.5**: تحسين عدد المضلعات للأداء
- **8.6**: إنتاج شبكات التصادم للفيزياء
- **8.7**: تضمين مواد PBR مع التوافق مع محركات الألعاب

## الخلاصة

تم تنفيذ المهمة 12.5 بنجاح مع إنشاء مجموعة شاملة من اختبارات الخصائص التي تتحقق من جميع جوانب نظام التصدير في Building Forge. الاختبارات تستخدم fast-check مع 100 تكرار كحد أدنى وتغطي جميع المتطلبات المحددة في وثيقة المتطلبات.

الاختبارات مصممة لتكون:

- **شاملة**: تغطي جميع خصائص التصدير
- **موثوقة**: تستخدم مولدات بيانات واقعية
- **قابلة للصيانة**: مع بنية واضحة ومنظمة
- **سريعة**: مع تحسينات للأداء
- **مفيدة**: تقدم تغذية راجعة واضحة عند الفشل
