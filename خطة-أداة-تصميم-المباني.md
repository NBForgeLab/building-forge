# خطة تطوير أداة تصميم المباني للألعاب
## Building Designer Tool for Game Development

### نظرة عامة
أداة تصميم معماري ثلاثي الأبعاد مخصصة لإنشاء مباني قابلة للاستخدام في ألعاب الفيديو. تتيح الأداة بناء الجدران والأرضيات وإضافة الأبواب والنوافذ مع إمكانية التصدير بصيغ متوافقة مع محركات الألعاب.

---

## الهيكل العام للتطبيق

### 1. واجهة المستخدم الرئيسية
- **العارض المركزي (3D Viewport)**: منطقة رسم ثلاثية الأبعاد تشغل معظم الشاشة
- **اللوحة الجانبية اليمنى**: أدوات التحكم والخصائص
- **شريط الأدوات العلوي**: الأدوات الأساسية والقوائم
- **شريط الحالة السفلي**: معلومات المشروع والإحداثيات

### 2. الأدوات الأساسية

#### أدوات البناء:
- **أداة الجدران**: رسم جدران بالنقر والسحب مع تحديد السماكة والارتفاع
- **أداة الأرضيات**: إنشاء أرضيات وأسقف مع دعم الأشكال المعقدة
- **أداة الأبواب**: وضع أبواب مع تحديد الأبعاد (عرض، ارتفاع، عمق الإطار)
- **أداة النوافذ**: إضافة نوافذ قابلة للتخصيص مع أحجام مختلفة
- **فرشاة القطع**: لقطع فتحات دقيقة في الجدران للأبواب والنوافذ

#### أدوات التحديد والتعديل:
- **أداة التحديد**: اختيار العناصر الفردية أو المتعددة
- **أداة النقل**: تحريك العناصر بدقة على المحاور
- **أداة التدوير**: تدوير العناصر بزوايا محددة
- **أداة التحجيم**: تغيير أحجام العناصر مع الحفاظ على النسب

### 3. اللوحة الجانبية - أقسام التحكم

#### قسم الأدوات:
- أيقونات الأدوات المختلفة مع اختصارات لوحة المفاتيح
- إعدادات الأداة المحددة حالياً (سماكة، ارتفاع، إلخ)
- أوضاع الرسم (حر، محدود بالشبكة، بزوايا 90 درجة)

#### قسم الخصائص:
- أبعاد العنصر المحدد (طول، عرض، ارتفاع) بوحدات الألعاب
- موقع العنصر (X, Y, Z) مع إمكانية التعديل المباشر
- خصائص المواد والألوان مع معاينة فورية

#### قسم المواد المخصصة للألعاب:
- مكتبة المواد المحسنة للألعاب (PBR Materials)
- إعدادات النسيج (Albedo, Normal, Roughness, Metallic)
- معاينة المواد في الوقت الفعلي
- إدارة UV Mapping للنسيج



### 4. التقنيات المقترحة

#### Frontend Stack (TypeScript بالكامل):
- **React 18+** مع **TypeScript 5.0+** للواجهة القوية والآمنة
- **Vite** كأداة بناء مع دعم ممتاز لـ TypeScript
- **Three.js** مع **@types/three** للرسم ثلاثي الأبعاد
- **React Three Fiber (@react-three/fiber)** لدمج Three.js مع React
- **@react-three/drei** للمكونات الجاهزة
- **Zustand** لإدارة الحالة مع TypeScript

#### مكتبات TypeScript المتخصصة:
- **three-stdlib** للأدوات الإضافية مع دعم TypeScript
- **@react-three/postprocessing** للتأثيرات البصرية
- **react-use-gesture** للتفاعل مع الماوس واللمس
- **leva** لواجهة التحكم بدلاً من dat.GUI
- **react-hotkeys-hook** للاختصارات

#### أدوات التطوير TypeScript:
- **TypeScript 5.0+** مع strict mode
- **ESLint** مع @typescript-eslint/parser
- **Prettier** مع دعم TypeScript
- **Vitest** للاختبار مع TypeScript
- **@types/react** و **@types/react-dom**

### 5. الميزات المخصصة للألعاب

#### تحسين الأداء:
- **Occlusion Culling**: إخفاء العناصر غير المرئية
- **Texture Atlasing**: دمج النسيج لتقليل Draw Calls
- **Mesh Optimization**: تحسين عدد المضلعات

#### أدوات القياس المخصصة للألعاب:
- وحدات قياس متوافقة مع محركات الألعاب (Unity Units, Unreal Units)
- مسطرة لقياس المسافات بدقة
- عرض الأبعاد تلقائياً مع إرشادات بصرية
- حساب المساحات والحجوم لتحسين الأداء

#### أدوات العرض المتقدمة:
- تبديل بين المناظير (أمامي، جانبي، علوي، منظور)
- إضاءة ديناميكية لمعاينة النتيجة النهائية
- عرض Wireframe و Solid مع إمكانية التبديل

### 6. التصدير المخصص للألعاب

#### صيغ التصدير:
- **BFORGE (.bforge)**: صيغة المشروع الأصلية للتطبيق
  - حفظ كامل لبيانات المشروع والإعدادات
  - دعم الاستيراد والتعديل اللاحق
  - ضغط البيانات فقط
  - حفظ تاريخ التعديلات والmetadata
- **GLB**: الصيغة المفضلة لمحركات الألعاب الحديثة
  - دعم المواد PBR
  - ضغط النسيج والهندسة
- **OBJ**: للتوافق مع الأدوات القديمة
  - دعم UV Coordinates
  - تحسين للاستيراد في أدوات النمذجة

#### إعدادات التصدير:
- **للمشاريع (.bforge)**:
  - تضمين الأصول (textures, materials)
  - حفظ إعدادات العرض والكاميرا
- **للألعاب (GLB/OBJ)**:
  - مستوى التفصيل (عالي، متوسط، منخفض)
  - ضغط النسيج (1024x1024, 512x512, 256x256)
  - تحسين المضلعات

### 7. تجربة المستخدم المحسنة

#### سهولة الاستخدام:
- اختصارات لوحة المفاتيح قابلة للتخصيص
- نصائح أدوات (tooltips) تفاعلية
- نظام التراجع/الإعادة متعدد المستويات

#### التفاعل المتقدم:
- سحب وإفلات للعناصر مع Snap to Grid
- تحديد متعدد مع عمليات جماعية
- نسخ ولصق العناصر مع الخصائص
- أدوات القياس التفاعلية

#### أدوات الإنتاجية:
- قوالب جاهزة للغرف الشائعة
- مكتبة عناصر قابلة للإعادة الاستخدام
- حفظ تلقائي للمشروع
- استيراد مراجع الصور للتصميم

### 8. هيكل المشروع TypeScript

```
game-building-designer/
├── src/
│   ├── components/
│   │   ├── Viewport/
│   │   │   ├── Scene3D.tsx
│   │   │   ├── Camera.tsx
│   │   │   ├── Controls.tsx
│   │   │   └── Grid.tsx
│   │   ├── Sidebar/
│   │   │   ├── ToolPanel.tsx
│   │   │   ├── PropertiesPanel.tsx
│   │   │   └── MaterialsPanel.tsx
│   │   ├── Toolbar/
│   │   │   ├── MainToolbar.tsx
│   │   │   ├── ViewControls.tsx
│   │   │   └── ExportControls.tsx
│   │   └── UI/
│   │       ├── Modal.tsx
│   │       ├── Button.tsx
│   │       ├── Input.tsx
│   │       ├── Slider.tsx
│   │       └── ColorPicker.tsx
│   ├── tools/
│   │   ├── base/
│   │   │   ├── Tool.ts
│   │   │   ├── ToolManager.ts
│   │   │   └── ToolState.ts
│   │   ├── WallTool.ts
│   │   ├── FloorTool.ts
│   │   ├── DoorTool.ts
│   │   ├── WindowTool.ts
│   │   ├── CutTool.ts
│   │   └── SelectTool.ts
│   ├── utils/
│   │   ├── geometry/
│   │   │   ├── GeometryUtils.ts
│   │   │   ├── MeshGenerator.ts
│   │   │   └── UVMapper.ts
│   │   ├── materials/
│   │   │   ├── MaterialManager.ts
│   │   │   ├── PBRMaterial.ts
│   │   │   └── TextureLoader.ts
│   │   ├── export/
│   │   │   ├── BForgeExporter.ts
│   │   │   ├── BForgeImporter.ts
│   │   │   ├── GLBExporter.ts
│   │   │   ├── OBJExporter.ts
│   │   │   └── ExportOptimizer.ts
│   │   ├── math/
│   │   │   ├── Vector3Utils.ts
│   │   │   ├── GeometryMath.ts
│   │   │   └── Intersection.ts
│   │   └── validation/
│   │       ├── GeometryValidator.ts
│   │       └── ExportValidator.ts
│   ├── store/
│   │   ├── slices/
│   │   │   ├── projectSlice.ts
│   │   │   ├── toolSlice.ts
│   │   │   ├── materialSlice.ts
│   │   │   └── settingsSlice.ts
│   │   ├── index.ts
│   │   └── middleware.ts
│   ├── types/
│   │   ├── core/
│   │   │   ├── Building.ts
│   │   │   ├── Element.ts
│   │   │   └── Transform.ts
│   │   ├── geometry/
│   │   │   ├── Wall.ts
│   │   │   ├── Floor.ts
│   │   │   ├── Door.ts
│   │   │   └── Window.ts
│   │   ├── materials/
│   │   │   ├── Material.ts
│   │   │   ├── Texture.ts
│   │   │   └── PBRProperties.ts
│   │   ├── tools/
│   │   │   ├── ToolTypes.ts
│   │   │   ├── ToolEvents.ts
│   │   │   └── ToolSettings.ts
│   │   ├── export/
│   │   │   ├── ExportSettings.ts
│   │   │   ├── BForgeFormat.ts
│   │   │   └── ExportResult.ts
│   │   └── ui/
│   │       ├── UIEvents.ts
│   │       └── ComponentProps.ts
│   ├── hooks/
│   │   ├── useThree.ts
│   │   ├── useTools.ts
│   │   ├── useExport.ts
│   │   ├── useImport.ts
│   │   ├── useBForge.ts
│   │   ├── useKeyboard.ts
│   │   ├── useMaterials.ts
│   │   └── useProject.ts
│   ├── constants/
│   │   ├── GameUnits.ts
│   │   ├── MaterialPresets.ts
│   │   ├── ToolSettings.ts
│   │   └── ExportDefaults.ts
│   ├── services/
│       ├── ProjectService.ts
│       ├── FileService.ts
│       ├── BForgeService.ts
│       └── ValidationService.ts
├── public/
│   ├── textures/
│   │   ├── materials/
│   │   └── ui/
│   ├── models/
│   │   └── templates/
│   └── icons/
├── assets/
│   ├── materials/
│   │   ├── presets.json
│   │   └── textures/
│   └── templates/
│       └── rooms/
├── types/
│   └── global.d.ts
├── docs/
│   ├── user-guide.md
│   ├── api-reference.md
│   └── type-definitions.md
├── tsconfig.json
├── vite.config.ts
├── eslint.config.js
└── package.json
```

### 9. أمثلة على الأنواع الأساسية (TypeScript)

#### أنواع الهندسة الأساسية:
```typescript
// types/core/Transform.ts
export interface Transform {
  position: Vector3;
  rotation: Euler;
  scale: Vector3;
}

// types/core/Element.ts
export interface BuildingElement {
  id: string;
  type: ElementType;
  transform: Transform;
  material: MaterialReference;
  properties: Record<string, unknown>;
  metadata: ElementMetadata;
}

// types/geometry/Wall.ts
export interface Wall extends BuildingElement {
  type: 'wall';
  startPoint: Vector3;
  endPoint: Vector3;
  height: number;
  thickness: number;
  openings: Opening[];
}

// types/geometry/Opening.ts
export interface Opening {
  id: string;
  type: 'door' | 'window';
  position: number; // موقع على الجدار (0-1)
  width: number;
  height: number;
  offsetFromFloor: number;
}
```

#### أنواع الأدوات:
```typescript
// types/tools/ToolTypes.ts
export interface Tool {
  readonly name: string;
  readonly icon: string;
  readonly shortcut: string;
  
  activate(): void;
  deactivate(): void;
  onMouseDown(event: MouseEvent, intersection?: Intersection): void;
  onMouseMove(event: MouseEvent, intersection?: Intersection): void;
  onMouseUp(event: MouseEvent, intersection?: Intersection): void;
  onKeyDown(event: KeyboardEvent): void;
}

// tools/base/Tool.ts
export abstract class BaseTool implements Tool {
  protected isActive: boolean = false;
  protected settings: ToolSettings;
  
  constructor(
    public readonly name: string,
    public readonly icon: string,
    public readonly shortcut: string
  ) {}
  
  abstract activate(): void;
  abstract deactivate(): void;
  // ... باقي الطرق
}
```

#### أنواع المواد:
```typescript
// types/materials/Material.ts
export interface PBRMaterial {
  id: string;
  name: string;
  albedo: Color | string;
  metallic: number;
  roughness: number;
  normal?: Texture;
  emission?: Color;
  opacity: number;
  doubleSided: boolean;
}

// types/materials/Texture.ts
export interface TextureInfo {
  url: string;
  repeat: Vector2;
  offset: Vector2;
  rotation: number;
  flipY: boolean;
}
```

#### أنواع التصدير والاستيراد:
```typescript
// types/export/BForgeFormat.ts
export interface BForgeProject {
  version: string;
  metadata: ProjectMetadata;
  building: BuildingData;
  materials: MaterialLibrary;
  settings: ProjectSettings;
  assets: AssetManifest;
  history?: ProjectHistory;
}

export interface ProjectMetadata {
  id: string;
  name: string;
  description?: string;
  author: string;
  created: Date;
  modified: Date;
  version: string;
  tags: string[];
  thumbnail?: string; // base64 encoded
}

export interface BuildingData {
  elements: BuildingElement[];
  groups: ElementGroup[];
  bounds: BoundingBox;
  units: 'unity' | 'unreal' | 'blender';
}

export interface AssetManifest {
  textures: TextureAsset[];
  materials: MaterialAsset[];
  models: ModelAsset[];
}

// types/export/ExportSettings.ts
export interface BForgeExportSettings {
  compression: 'none' | 'normal' | 'high';
  includeAssets: boolean;
  includeHistory: boolean;
  includeViewSettings: boolean;
}

export interface ExportSettings {
  format: 'bforge' | 'glb' | 'obj';
  bforge?: BForgeExportSettings;
  game?: GameExportSettings;
}

export interface GameExportSettings {
  quality: 'high' | 'medium' | 'low';
  textureSize: 256 | 512 | 1024 | 2048;
  generateColliders: boolean;
  optimizeMesh: boolean;
  embedTextures: boolean;
  units: 'unity' | 'unreal' | 'blender';
}
```

// types/export/ExportResult.ts
export interface ExportResult {
  success: boolean;
  data?: Blob;
  filename: string;
  stats: {
    vertices: number;
    faces: number;
    materials: number;
    fileSize: number;
  };
  errors?: string[];
  warnings?: string[];
}
```

### 10. خطة التطوير المرحلية (TypeScript)

#### المرحلة الأولى (إعداد TypeScript والأساسيات):
- إعداد مشروع Vite مع TypeScript وتكوين strict mode
- تعريف الأنواع الأساسية (Building, Element, Transform)
- إعداد الواجهة الأساسية مع React و Three.js
- تطبيق العارض ثلاثي الأبعاد مع كاميرا قابلة للتحكم
- أداة رسم الجدران البسيطة مع type safety
- نظام التحديد الأساسي مع أنواع محددة

#### المرحلة الثانية (الأدوات والتفاعل):
- تطبيق نظام الأدوات مع abstract classes
- إضافة أدوات الأرضيات والأسقف مع type definitions
- تطبيق نظام التحديد والتعديل المتقدم
- اللوحة الجانبية مع strongly typed props
- نظام المواد البسيط مع PBR interfaces
- إضافة validation للبيانات المدخلة

#### المرحلة الثالثة (الميزات المتقدمة):
- أدوات الأبواب والنوافذ مع generic types
- فرشاة القطع للفتحات الدقيقة
- نظام المواد المتقدم مع PBR وtype safety
- أدوات القياس والإرشادات البصرية
- إضافة unit tests مع Vitest
- تحسين الأداء مع TypeScript optimizations

#### المرحلة الرابعة (التصدير والتحسين):
- تطبيق تصدير GLB و OBJ مع type-safe APIs
- تحسين الأداء للألعاب (Optimization)
- الميزات المتقدمة (قوالب، مكتبة عناصر)
- إضافة error handling شامل
- تحسين TypeScript compiler performance

#### المرحلة الخامسة (التلميع والتوثيق):
- تحسين تجربة المستخدم مع better typing
- إضافة الدليل التفاعلي
- اختبار الأداء والاستقرار
- إعداد التوثيق الشامل للـ APIs
- إنتاج type definitions للمطورين
- تحسين bundle size وtree shaking

### 11. متطلبات الأداء للألعاب (TypeScript)

#### تحسين المضلعات:
- حد أقصى للمضلعات حسب نوع اللعبة
- خوارزميات تبسيط الهندسة
- دمج المضلعات المتجاورة

#### إدارة النسيج:
- ضغط النسيج بدون فقدان الجودة
- إعادة استخدام النسيج للعناصر المتشابهة
- تحسين UV Mapping

#### معلومات التصادم:
- إنتاج Collision Meshes مبسطة
- دعم أشكال التصادم الأساسية (Box, Sphere, Capsule)
- تحسين دقة التصادم حسب الحاجة

---

## الخلاصة

هذه الأداة ستوفر حلاً شاملاً لمطوري الألعاب لإنشاء مباني ثلاثية الأبعاد محسنة للأداء وقابلة للاستخدام مباشرة في محركات الألعاب. التركيز على التصدير بصيغتي GLB و OBJ يضمن التوافق الواسع مع جميع محركات الألعاب الحديثة.

### 12. ملفات التكوين TypeScript

#### tsconfig.json:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/types/*": ["./src/types/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/store/*": ["./src/store/*"]
    }
  },
  "include": ["src", "types"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

#### vite.config.ts:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, './src'),
      '@/components': resolve(__dirname, './src/components'),
      '@/types': resolve(__dirname, './src/types'),
      '@/utils': resolve(__dirname, './src/utils'),
      '@/hooks': resolve(__dirname, './src/hooks'),
      '@/store': resolve(__dirname, './src/store')
    }
  },
  optimizeDeps: {
    include: ['three', '@react-three/fiber', '@react-three/drei']
  }
})
```

### 13. مزايا TypeScript في هذا المشروع

#### الأمان والموثوقية:
- منع الأخطاء الشائعة في التعامل مع Three.js objects
- type safety للعمليات الهندسية المعقدة
- فحص صحة البيانات قبل التصدير
- اكتشاف مشاكل التوافق مع محركات الألعاب مبكراً

#### الإنتاجية:
- IntelliSense قوي للـ Three.js APIs
- refactoring آمن للكود المعقد
- documentation تلقائية للواجهات
- أخطاء واضحة ومفيدة أثناء التطوير

#### القابلية للصيانة:
- كود أكثر وضوحاً للفرق الكبيرة
- interfaces واضحة بين المكونات
- تطوير متوازي آمن
- اختبار أسهل مع type mocking

---

## الخلاصة المحدثة

الأداة ستكون مبنية بالكامل على TypeScript مما يضمن:
- **أمان عالي** في التعامل مع البيانات الهندسية المعقدة
- **أداء محسن** مع compile-time optimizations
- **سهولة التطوير** مع IntelliSense وtype checking
- **قابلية الصيانة** للمشاريع طويلة المدى
- **توافق ممتاز** مع النظام البيئي الحديث للتطوير

التركيز على TypeScript سيجعل الأداة أكثر احترافية وموثوقية لمطوري الألعاب.

### 14. تفاصيل صيغة BFORGE

#### مواصفات الصيغة:
```typescript
// utils/export/BForgeExporter.ts
export class BForgeExporter {
  async exportProject(
    building: Building, 
    settings: BForgeExportSettings
  ): Promise<Blob> {
    const project: BForgeProject = {
      version: '1.0.0',
      metadata: this.generateMetadata(),
      building: this.serializeBuilding(building),
      materials: this.serializeMaterials(),
      settings: this.serializeSettings(),
      assets: await this.packageAssets(settings.includeAssets),
      history: settings.includeHistory ? this.serializeHistory() : undefined
    };

    let data = JSON.stringify(project);
    
    if (settings.compression !== 'none') {
      data = await this.compressData(data, settings.compression);
    }

    return new Blob([data], { type: 'application/bforge' });
  }

  private async compressData(data: string, level: 'normal' | 'high'): Promise<string> {
    // استخدام pako أو مكتبة ضغط أخرى
    const compressionLevel = level === 'high' ? 9 : 6;
    return await compress(data, compressionLevel);
  }

  private async encryptData(data: string, password: string): Promise<string> {
    // استخدام Web Crypto API للضغط المتقدم
    const key = await this.deriveKey(password);
    return await this.compress(data, key);
  }
}

// utils/export/BForgeImporter.ts
export class BForgeImporter {
  async importProject(file: File): Promise<BForgeProject> {
    let data = await file.text();
    
    // محاولة فك الضغط
    if (this.isCompressed(data)) {
      data = await this.decompressData(data);
    }
    
    const project: BForgeProject = JSON.parse(data);
    
    // التحقق من صحة البيانات
    this.validateProject(project);
    
    return project;
  }

  private validateProject(project: BForgeProject): void {
    if (!project.version || !project.metadata || !project.building) {
      throw new Error('Invalid BFORGE file format');
    }
    
    // التحقق من توافق الإصدار
    if (!this.isVersionCompatible(project.version)) {
      throw new Error(`Unsupported BFORGE version: ${project.version}`);
    }
  }
}
```

#### ميزات صيغة BFORGE:

##### 1. حفظ شامل للمشروع:
- جميع العناصر الهندسية مع خصائصها
- المواد والنسيج المستخدمة
- إعدادات الأدوات والعرض
- تاريخ التعديلات (اختياري)
- معلومات المشروع والمؤلف

##### 2. الضغط والتحسين:
- ضغط البيانات لتوفير المساحة

##### 3. إدارة الأصول:
- تضمين النسيج والمواد في الملف
- مراجع خارجية للأصول الكبيرة
- تحسين حجم الملف

##### 4. التوافق والإصدارات:
- نظام إصدارات للتوافق المستقبلي
- migration تلقائي للإصدارات القديمة
- دعم الإضافات والتوسعات

#### واجهة المستخدم للاستيراد/التصدير:
```typescript
// components/Toolbar/ExportControls.tsx
export const ExportControls: React.FC = () => {
  const [exportFormat, setExportFormat] = useState<'bforge' | 'glb' | 'obj'>('bforge');
  const [showSettings, setShowSettings] = useState(false);
  
  const handleExport = async () => {
    switch (exportFormat) {
      case 'bforge':
        await exportBForge();
        break;
      case 'glb':
        await exportGLB();
        break;
      case 'obj':
        await exportOBJ();
        break;
    }
  };

  return (
    <div className="export-controls">
      <select 
        value={exportFormat} 
        onChange={(e) => setExportFormat(e.target.value as any)}
      >
        <option value="bforge">مشروع BFORGE (.bforge)</option>
        <option value="glb">نموذج GLB (.glb)</option>
        <option value="obj">نموذج OBJ (.obj)</option>
      </select>
      
      <button onClick={handleExport}>تصدير</button>
      <button onClick={() => setShowSettings(true)}>إعدادات</button>
      
      {showSettings && (
        <ExportSettingsModal 
          format={exportFormat}
          onClose={() => setShowSettings(false)}
        />
      )}
    </div>
  );
};

// components/Toolbar/ImportControls.tsx
export const ImportControls: React.FC = () => {
  const fileInputRef = useRef<HTMLInputElement>(null);
  
  const handleImport = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;
    
    const extension = file.name.split('.').pop()?.toLowerCase();
    
    switch (extension) {
      case 'bforge':
        await importBForge(file);
        break;
      default:
        alert('صيغة الملف غير مدعومة');
    }
  };

  return (
    <div className="import-controls">
      <input
        ref={fileInputRef}
        type="file"
        accept=".bforge"
        onChange={handleImport}
        style={{ display: 'none' }}
      />
      <button onClick={() => fileInputRef.current?.click()}>
        استيراد مشروع
      </button>
    </div>
  );
};
```

#### مثال على استخدام الخدمة:
```typescript
// services/BForgeService.ts
export class BForgeService {
  private exporter = new BForgeExporter();
  private importer = new BForgeImporter();

  async saveProject(
    building: Building, 
    filename: string, 
    settings: BForgeExportSettings
  ): Promise<void> {
    const blob = await this.exporter.exportProject(building, settings);
    this.downloadBlob(blob, `${filename}.bforge`);
  }

  async loadProject(file: File): Promise<Building> {
    const project = await this.importer.importProject(file);
    return this.deserializeBuilding(project.building);
  }

  private downloadBlob(blob: Blob, filename: string): void {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }
}
```

هذا التحديث يضيف صيغة BFORGE كصيغة مشروع أصلية للتطبيق مع إمكانيات متقدمة للحفظ والاستيراد!